const express = require('express'); const fs = require('fs'); const path = require('path'); const bodyParser = require('body-parser'); const app = express(); app.use(bodyParser.json()); const SESS = path.join(__dirname, 'sessions.json'); function readS(){ if(!fs.existsSync(SESS)) return {}; try { return JSON.parse(fs.readFileSync(SESS)); } catch(e){ return {}; } } function writeS(s){ fs.writeFileSync(SESS, JSON.stringify(s, null, 2)); } app.post('/api/session', (req, res) => { const s = readS(); const code = req.body.code || ('MM'+Math.random().toString(36).slice(2,8).toUpperCase()); s[code] = { createdAt: Date.now(), femaleAnswers: req.body.femaleAnswers || null, maleAnswers: req.body.maleAnswers || null, disqualified: false }; writeS(s); res.json({ ok:true, code }); }); app.get('/api/session/:code', (req, res) => { const s = readS(); res.json(s[req.params.code] || null); }); app.post('/api/session/:code/complete', (req, res) => { const s = readS(); const code = req.params.code; if(!s[code]) return res.status(404).json({ error:'not found' }); s[code].maleAnswers = req.body.maleAnswers; s[code].completedAt = Date.now(); writeS(s); res.json({ ok:true }); }); app.post('/api/session/:code/disqualify', (req,res)=>{ const s = readS(); const code = req.params.code; if(!s[code]) return res.status(404).json({error:'not found'}); s[code].disqualified = true; writeS(s); res.json({ok:true}); }); const PORT = process.env.PORT || 3000; app.listen(PORT, ()=>console.log('Server listening on', PORT));